import{o as g,_ as I,S as h,c as C,d as k,e as x,g as B,n as w,i as y,s as b,j as D,q as le,F as L,f as te,a as ne}from"./index-BJq-9179.js";import{S as _,b as S,g as ue}from"./index-BwDjUviV.js";import{i as pe}from"./i18next-Lgj2Bm8L.js";import{U as oe}from"./ua-parser-CvpKYoEI.js";const se=["en","ru","vi","uk","pl","it","fr","nl","da","es","de","zh_CN","ar"],A="en",de=new Map([["en","English"],["ru","Русский"],["vi","Tiếng Việt"],["uk","Українська"],["pl","Polskie"],["it","Italiano"],["fr","Français"],["nl","Nederlands"],["da","Dansk"],["es","Español"],["de","Deutsche"],["zh_CN","繁體中文"],["ar","العربية"]]),he=g({locale:I(se).optional().describe(h.persist)}).default({}),fe=new C(he);function K(v){return!!(v&&typeof v=="string"&&se.includes(v))}const ge={"connect-status":{off:"أنت غير متصل",on:"أنت متصل بـ {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"فشل الاتصال، يرجى تعطيل الملحقات الأخرى.","not-controllable":"فشل الاتصال، ولا يمكن التحكم في وكيل المتصفح.","no-location":"خطأ في الاتصال، موقع الاتصال مفقود.","server-config":"خطأ في الاتصال، لا يمكن جلب تكوين الخادم.",captive:"فشل الاتصال، لا يمكن تأسيس اتصال الوكيل.","no-internet":"خطأ في الاتصال، لا يوجد اتصال بالشبكة."},"disconnect-errors":{"remove-proxy":"خطأ في قطع الاتصال، فشلت عملية إزالة قواعد الوكيل."},"download-notification":{title:"جرّب عميل الوكيل لسطح المكتب الخاص بنا",message:"حماية اتصالك بالإنترنت بالكامل، وليس المتصفح فقط"},"update-notification":{title:"تم تحديث الإضافة",message:"مرحبا بك في {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"يتم التحكم في الإعداد بواسطة ملحق آخر.","not-controllable":"الإعداد لا يمكن التحكم فيه من خلال إعدادات المتصفح الخاص بك.","remove-webrtc":"لا يمكن مسح إعدادات WebRTC."}},me=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"})),be={"connect-status":{off:"Du er ikke forbundet",on:"Du er forbundet til {{tr_location}}."},"connect-errors":{"controlled-by-other-extensions":"Forbindelsen mislykkedes. Deaktiver venligst andre udvidelser.","not-controllable":"Forbindelsen mislykkedes, browserproxy kan ikke kontrolleres.","no-location":"Forbindelsesfejl, manglende forbindelsesplacering.","server-config":"Forbindelsesfejl, serverkonfigurationen kan ikke hentes.",captive:"Forbindelsen mislykkedes, kan ikke oprette proxyforbindelse.","no-internet":"Forbindelsesfejl, ingen netværksforbindelse."},"disconnect-errors":{"remove-proxy":"Afbrydelsesfejl, fjernelse af proxyregler mislykkedes."},"download-notification":{title:"Prøv vores Desktop Proxy-klient",message:"Beskyt hele din internetforbindelse, ikke kun browseren"},"update-notification":{title:"Udvidelse opdateret",message:"Velkommen til {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Indstilling kontrolleret af anden udvidelse.","not-controllable":"Indstillingen kan ikke kontrolleres via dine browserindstillinger.","remove-webrtc":"Kan ikke rydde WebRTC-indstillinger."}},ve=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),we={"connect-status":{off:"Sie sind nicht verbunden",on:"Sie sind mit {{tr_location}} verbunden"},"connect-errors":{"controlled-by-other-extensions":"Die Verbindung ist fehlgeschlagen. Bitte deaktivieren Sie andere Erweiterungen.","not-controllable":"Verbindung fehlgeschlagen, Browser-Proxy ist nicht steuerbar.","no-location":"Verbindungsfehler, Verbindungsstandort fehlt.","server-config":"Verbindungsfehler, Serverkonfiguration kann nicht abgerufen werden.",captive:"Verbindung fehlgeschlagen, Proxy-Verbindung kann nicht hergestellt werden.","no-internet":"Verbindungsfehler, keine Netzwerkverbindung."},"disconnect-errors":{"remove-proxy":"Fehler beim Trennen der Verbindung. Das Entfernen der Proxy-Regeln ist fehlgeschlagen."},"download-notification":{title:"Probieren Sie unseren Desktop-Proxy-Client aus",message:"Schützen Sie Ihre gesamte Internetverbindung, nicht nur den Browser"},"update-notification":{title:"Erweiterung aktualisiert",message:"Willkommen zu {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Einstellung wird von einer anderen Nebenstelle gesteuert.","not-controllable":"Die Einstellung kann nicht über Ihre Browsereinstellungen gesteuert werden.","remove-webrtc":"WebRTC-Einstellungen können nicht gelöscht werden."}},ye=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Se={"connect-status":{off:"You are not connected",on:"You are connected to {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Connection failed. Please disable other extensions.","not-controllable":"Connection failed. Browser proxy is not controllable.","no-location":"Connection Error. Missing connection location.","server-config":"Connection Error. Can't fetch server config.",captive:"Connection failed. Cannot establish proxy connection.","no-internet":"Connection Error. No Network connection."},"disconnect-errors":{"remove-proxy":"Disconnect Error. Proxy rules remove failed."},"download-notification":{title:"Try our Desktop Proxy Client",message:"Protect your entire internet connection, not just browser"},"update-notification":{title:"Extension updated",message:"Welcome to {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Setting controlled by other extension.","not-controllable":"Setting not controllable through your browser settings.","remove-webrtc":"Can't clear WebRTC settings."}},xe=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),_e={"connect-status":{off:"No está conectado",on:"Estás conectado a {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"La conexión falló. Desactive otras extensiones.","not-controllable":"La conexión falló, el proxy del navegador no es controlable.","no-location":"Error de conexión, falta ubicación de conexión.","server-config":"Error de conexión, no se puede recuperar la configuración del servidor.",captive:"La conexión falló, no se puede establecer la conexión proxy.","no-internet":"Error de conexión, sin conexión de red."},"disconnect-errors":{"remove-proxy":"Error de desconexión, error al eliminar las reglas de proxy."},"download-notification":{title:"Prueba nuestro Cliente Proxy de Escritorio",message:"Proteja toda su conexión a Internet, no sólo el navegador"},"update-notification":{title:"Extensión actualizada",message:"Bienvenido a {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Configuración controlada por otra extensión.","not-controllable":"Configuración no controlable a través de la configuración de su navegador.","remove-webrtc":"No se puede borrar la configuración de WebRTC."}},Ie=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"})),Ce={"connect-status":{off:"Vous n'êtes pas connecté",on:"Vous êtes connecté à {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"La connexion a échoué. Veuillez désactiver les autres extensions.","not-controllable":"La connexion a échoué, le proxy du navigateur n'est pas contrôlable.","no-location":"Erreur de connexion, emplacement de connexion manquant.","server-config":"Erreur de connexion, impossible de récupérer la configuration du serveur.",captive:"Échec de la connexion, impossible d'établir une connexion proxy.","no-internet":"Erreur de connexion, pas de connexion réseau."},"disconnect-errors":{"remove-proxy":"Erreur de déconnexion. La suppression des règles de proxy a échoué."},"download-notification":{title:"Essayez notre client Proxy de bureau",message:"Protégez l'ensemble de votre connexion Internet, et pas seulement votre navigateur"},"update-notification":{title:"Extension mise à jour",message:"Bienvenue à {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Paramètre contrôlé par une autre extension.","not-controllable":"Paramètre non contrôlable via les paramètres de votre navigateur.","remove-webrtc":"Impossible d'effacer les paramètres WebRTC."}},ke=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),Te={"connect-status":{off:"Non siete connessi",on:"Sei connesso a {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Connessione non riuscita. Disattiva le altre estensioni.","not-controllable":"Connessione non riuscita, il proxy del browser non è controllabile.","no-location":"Errore di connessione, posizione della connessione mancante.","server-config":"Errore di connessione, impossibile recuperare la configurazione del server.",captive:"Connessione non riuscita, impossibile stabilire una connessione proxy.","no-internet":"Errore di connessione, nessuna connessione di rete."},"disconnect-errors":{"remove-proxy":"Errore di disconnessione, rimozione delle regole proxy non riuscita."},"download-notification":{title:"Prova il nostro Client Proxy Desktop",message:"Proteggere l'intera connessione a Internet, non solo il browser"},"update-notification":{title:"Estensione aggiornata",message:"Benvenuto a {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Impostazione controllata da un altro interno.","not-controllable":"Impostazione non controllabile tramite le impostazioni del browser.","remove-webrtc":"Impossibile cancellare le impostazioni WebRTC."}},Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"})),Ee={"connect-status":{off:"U bent niet verbonden",on:"Je bent verbonden met {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Verbinding mislukt. Schakel andere extensies uit.","not-controllable":"Verbinding mislukt, browserproxy kan niet worden beheerd.","no-location":"Verbindingsfout, ontbrekende verbindingslocatie.","server-config":"Verbindingsfout, kan serverconfiguratie niet ophalen.",captive:"Verbinding mislukt. Kan geen proxyverbinding tot stand brengen.","no-internet":"Verbindingsfout, geen netwerkverbinding."},"disconnect-errors":{"remove-proxy":"Verbindingsfout, verwijderen van proxyregels mislukt."},"download-notification":{title:"Probeer onze Desktop Proxy Client",message:"Bescherm je hele internetverbinding, niet alleen je browser"},"update-notification":{title:"Extensie bijgewerkt",message:"Welkom bij {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Instelling beheerd door een ander toestel.","not-controllable":"Instelling kan niet worden beheerd via uw browserinstellingen.","remove-webrtc":"Kan WebRTC-instellingen niet wissen."}},Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"})),De={"connect-status":{off:"Nie jesteś połączony",on:"Jesteś połączony z {{tr_location}}."},"connect-errors":{"controlled-by-other-extensions":"Połączenie nie powiodło się. Wyłącz inne rozszerzenia.","not-controllable":"Połączenie nie powiodło się, nie można kontrolować serwera proxy przeglądarki.","no-location":"Błąd połączenia, brak lokalizacji połączenia.","server-config":"Błąd połączenia. Nie można pobrać konfiguracji serwera.",captive:"Połączenie nie powiodło się. Nie można nawiązać połączenia proxy.","no-internet":"Błąd połączenia, brak połączenia sieciowego."},"disconnect-errors":{"remove-proxy":"Błąd rozłączenia, usunięcie reguł proxy nie powiodło się."},"download-notification":{title:"Wypróbuj nasz Klient Proxy na Pulpit",message:"Ochrona całego połączenia internetowego, nie tylko przeglądarki"},"update-notification":{title:"Rozszerzenie zaktualizowane",message:"Witamy w {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Ustawienie kontrolowane przez inne rozszerzenie.","not-controllable":"Ustawienie, którego nie można kontrolować za pomocą ustawień przeglądarki.","remove-webrtc":"Nie można wyczyścić ustawień WebRTC."}},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"})),Oe={"connect-status":{off:"Вы не подключены",on:"Вы подключены к {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Не удалось подключиться. Отключите другие расширения.","not-controllable":"Соединение не удалось, прокси-сервер браузера не контролируется.","no-location":"Ошибка подключения, отсутствует место подключения.","server-config":"Ошибка подключения. Невозможно получить конфигурацию сервера.",captive:"Не удалось установить соединение. Невозможно установить прокси-соединение.","no-internet":"Ошибка подключения. Нет подключения к сети."},"disconnect-errors":{"remove-proxy":"Ошибка отключения. Не удалось удалить правила прокси."},"download-notification":{title:"Попробуйте наш Desktop Proxy Client",message:"Защитите все свое интернет-соединение, а не только браузер"},"update-notification":{title:"Расширение обновлено",message:"Добро пожаловать в {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Настройка контролируется другим расширением.","not-controllable":"Настройка не контролируема через настройки вашего браузера.","remove-webrtc":"Не удалось очистить настройки WebRTC."}},Le=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),Ne={"connect-status":{off:"Ви не підключені",on:"Ви підключені до {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Помилка підключення. Вимкніть інші розширення.","not-controllable":"Помилка підключення, проксі-сервер веб-переглядача неможливо контролювати.","no-location":"Помилка підключення, відсутнє місце підключення.","server-config":"Помилка підключення, не вдається отримати конфігурацію сервера.",captive:"Помилка з’єднання, неможливо встановити проксі-з’єднання.","no-internet":"Помилка підключення. Відсутнє інтернет з'єднання."},"disconnect-errors":{"remove-proxy":"Помилка відключення, не вдалося видалити правила проксі."},"download-notification":{title:"Спробуйте наш Desktop Proxy Client",message:"Повністю захистіть підключення до Інтернету, а не лише через браузер"},"update-notification":{title:"Розширення оновлено",message:"Ласкаво просимо до {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Налаштування контролюється іншим розширенням.","not-controllable":"Налаштування не контрольоване через налаштування вашого браузера.","remove-webrtc":"Не вдається очистити налаштування WebRTC."}},ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),$e={"connect-status":{off:"Bạn chưa được kết nối",on:"Bạn được kết nối với {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"Kết nối không thành công, vui lòng tắt các tiện ích mở rộng khác.","not-controllable":"Kết nối không thành công, proxy trình duyệt không thể kiểm soát được.","no-location":"Lỗi kết nối, Thiếu vị trí kết nối.","server-config":"Lỗi kết nối, Không thể tìm nạp cấu hình máy chủ.",captive:"Kết nối không thành công, Không thể thiết lập kết nối proxy.","no-internet":"Lỗi kết nối, Không có kết nối mạng."},"disconnect-errors":{"remove-proxy":"Lỗi ngắt kết nối, xóa quy tắc proxy không thành công."},"download-notification":{title:"Thử dùng Ứng dụng Máy tính để bàn Proxy của chúng tôi",message:"Bảo vệ toàn bộ kết nối internet của bạn, không chỉ trình duyệt"},"update-notification":{title:"Đã cập nhật tiện ích mở rộng",message:"Chào mừng bạn đến {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"Cài đặt được kiểm soát bởi tiện ích mở rộng khác.","not-controllable":"Cài đặt không thể kiểm soát được thông qua cài đặt trình duyệt của bạn.","remove-webrtc":"Không thể xóa cài đặt WebRTC."}},Ue=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"})),je={"connect-status":{off:"您尚未连接",on:"您已连接到 {{tr_location}}"},"connect-errors":{"controlled-by-other-extensions":"连接失败，请禁用其他扩展。","not-controllable":"连接失败，浏览器代理不受控制。","no-location":"连接错误，缺少连接位置。","server-config":"连接错误，无法获取服务器配置。",captive:"连接失败，无法建立代理连接。","no-internet":"连接错误，无网络连接。"},"disconnect-errors":{"remove-proxy":"断开连接错误，代理规则删除失败。"},"download-notification":{title:"试试我们的桌面代理客户端",message:"保护您的整个互联网连接，而不仅仅是浏览器"},"update-notification":{title:"扩展已更新",message:"欢迎来到 {{tr_version}}"},"webrtc-errors":{"controlled-by-other-extensions":"由其他分机控制的设置。","not-controllable":"无法通过浏览器设置控制设置。","remove-webrtc":"无法清除 WebRTC 设置。"}},Me=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));class N extends _{constructor(e){super(),this.i18nStorage=e}translator=pe;get activeLocale(){return this.i18nStorage.state.locale??A}get languageList(){return[...de.entries()].map(([e,s])=>({code:e,label:s}))}async boot(){if(await this.i18nStorage.sync(),!this.i18nStorage.state.locale){const s=N.getUILanguage();await this.setLocale(s)}const e=N.buildResources();await this.translator.init({resources:e,lng:this.activeLocale,fallbackLng:A,interpolation:{escapeValue:!1}}),this.bootResolve(),await this.bootPromise}t(e,s={}){return this.translator.t(e,s)}async setLocale(e){await this.i18nStorage.setItems({locale:e})}static getUILanguage(){const e=S.i18n.getUILanguage(),s=e.replaceAll("-","_");if(K(s))return s;const c=e.substring(0,2);return K(c)?c:A}static buildResources(){return Object.entries(Object.assign({"./locales/ar/base.json":me,"./locales/da/base.json":ve,"./locales/de/base.json":ye,"./locales/en/base.json":xe,"./locales/es/base.json":Ie,"./locales/fr/base.json":ke,"./locales/it/base.json":Pe,"./locales/nl/base.json":Re,"./locales/pl/base.json":Ae,"./locales/ru/base.json":Le,"./locales/uk/base.json":ze,"./locales/vi/base.json":Ue,"./locales/zh_CN/base.json":Me})).reduce((s,[c,u])=>{const p=c.split("/").at(-2),d=c.split("/").at(-1).split(".").at(0);return s[p]={...s[p],[d]:u.default},s},{})}}const Ve=new k("i18n",fe,x),Be=new N(Ve),Y="chrome",We="app",Fe="chrome_extension",j={pricing:"https://veepn.com/{lang_code}/vpn-pricing/extension/",pricingPayment:"https://order.veepn.com/{lang_code}/pricing/extension/payment/",pricingSecurity:"https://order.veepn.com/{lang_code}/pricing/security/",pricingDiscount:"https://order.veepn.com/{lang_code}/pricing/60off/",home:"https://veepn.com/{lang_code}/",install:`https://veepn.com/{lang_code}/welcome/${Y}/`,uninstall:`https://veepn.com/{lang_code}/uninstall/${Y}/1/`,ipDetails:"https://veepn.com/{lang_code}/what-is-my-ip/",privacyPolicy:"https://veepn.com/{lang_code}/privacy-policy/",termsOfService:"https://veepn.com/{lang_code}/terms-of-service/",update:"https://veepn.com/{lang_code}/upgrade/",breachAlert:"https://veepn.com/{lang_code}/alert/",support:"https://help.veepn.com/hc/en-us/requests/new?&tf_14507823685010=extensions",supportTroubleshooting:"https://help.veepn.com/hc/en-us/categories/19479919000338-Troubleshooting",accountAuth:"https://account.veepn.com/{lang_code}/account-auth/",accountPasswordRecovery:"https://account.veepn.com/{lang_code}/password-recovery/"},qe=["de","ar","th","vi","en","es","fr","id","hi","it","jp","nl","no","pl","pt","ru","se","tr","zh","uk"],Ge="en";class Ke extends _{constructor(e,s){super(),this.globalStateService=e,this.i18nService=s}get websiteLangCode(){const e=this.i18nService.activeLocale.split("_")[0];return qe.find(c=>c===e)??Ge}async boot(){this.bootResolve(),await this.bootPromise}async proceedToWebsiteAccount(e){const s=this.constructUrl(j.accountAuth+e.authToken,e.route,e.params);await S.tabs.create({url:s})}async proceedToWebsitePage(e){const s=this.constructUrl(j[e.page],"",e.params);await S.tabs.create({url:s})}async setUninstallURL(){const e=this.constructUrl(j.uninstall,"");await S.runtime.setUninstallURL(e)}constructUrl(e,s,c){const u=new URLSearchParams({utm_source:Fe,utm_medium:We,platform:"extension",udid:this.globalStateService.udid.value,...c??{}}),p=this.websiteLangCode===A?e.replace("/{lang_code}",""):e.replace("{lang_code}",this.websiteLangCode);if(s)return`${p}/?route=${encodeURIComponent(`${s}?${u.toString()}`)}`;const d=new URL(p);return u.forEach((m,P)=>{d.searchParams.set(P,m)}),d.toString()}}const fn=new Ke(B,Be),re="default",Ye=[re,"light","dark"],ie=336*60*60*1e3,He=384*60*60*1e3,Xe="app",Je="chrome_extension",Ze={macos:"https://download.veepn.com/mac/VeePN.dmg",windows:"https://download.veepn.com/windows/VeePNInstaller.exe",linux:"https://veepn.com/vpn-apps/vpn-for-linux/",other:`https://order.veepn.com/pricing/extension/?utm_source=${Je}&utm_medium=${Xe}&utm_campaign=download`},Qe=10080*60*1e3,et=1200*1e3,tt=10080*60*1e3,nt=4,ot="https://chromewebstore.google.com/detail/free-vpn-for-chrome-vpn-p/_runtime_id_/reviews",st=900*1e3,rt=1440*60*1e3,it=1440*60*1e3,at=g({needShow:y(),nextTimestamp:w(),showCount:w()}),ct=g({needShow:y()}),lt=g({needShow:y(),count:w(),nextTimestamp:w()}),ut=g({close:lt,active:y(),nextTimestamp:w()}),pt=g({active:y()}),dt=g({active:y()}),ht=g({active:y()}),ft=g({active:y(),nextTimestamp:w()}),gt=g({active:y(),nextTimestamp:w()}),mt=g({colorTheme:I(Ye).describe(h.persist),showOnboarding:y().describe(h.persist),sessionCount:w().describe(h.persist),downloadNotificationTimestamp:w().describe(h.persist),blockAds:y().describe(h.persist),rateUs:at.describe(h.persist),exitOffer:ct.describe(h.persist),connectionSurvey:ut.describe(h.persist),banner2Session:pt.describe(h.persist),banner3Connection:dt.describe(h.persist),banner15Connection:ht.describe(h.persist),banner14Days:ft.describe(h.persist),banner16Days:gt.describe(h.persist)}).default({colorTheme:re,showOnboarding:!0,sessionCount:0,downloadNotificationTimestamp:0,blockAds:!1,rateUs:{needShow:!0,nextTimestamp:Date.now()+et,showCount:1},exitOffer:{needShow:!0},connectionSurvey:{close:{needShow:!0,count:0,nextTimestamp:Date.now()},active:!0,nextTimestamp:Date.now()},banner2Session:{active:!0},banner3Connection:{active:!0},banner15Connection:{active:!0},banner14Days:{active:!1,nextTimestamp:Date.now()+ie},banner16Days:{active:!0,nextTimestamp:Date.now()+He}}),bt=new C(mt),vt=oe(navigator.userAgent);class wt extends _{constructor(e){super(),this.appStorage=e}get colorTheme(){return this.appStorage.state.colorTheme}get version(){return S.runtime.getManifest().version}get showOnboarding(){return this.appStorage.state.showOnboarding}get sessionCount(){return this.appStorage.state.sessionCount}get downloadNotificationTimestamp(){return this.appStorage.state.downloadNotificationTimestamp}get isBlockAds(){return this.appStorage.state.blockAds}get majorBrowserVersion(){const e=Number(vt.browser.major);return Number.isNaN(e)?0:e}get rateUsData(){return this.appStorage.state.rateUs}get extensionStoreUrl(){const e=S.runtime.id;return ot.replace("_runtime_id_",e)}get needShowConnectionSurvey(){const{connectionSurvey:e}=this.appStorage.state,s=Date.now()>e.nextTimestamp;return e.active&&s}get connectionSurveyClose(){return this.appStorage.state.connectionSurvey.close}async boot(){await this.appStorage.sync(),this.bootResolve(),await this.bootPromise}async setColorTheme(e){await this.appStorage.setItems({colorTheme:e})}async setShowOnboarding(e){await this.appStorage.setItems({showOnboarding:e})}async incrementSessionCount(){const e=this.appStorage.state.sessionCount+1;await this.appStorage.setItems({sessionCount:e})}async getDownloadLink(e){return await Promise.resolve(this),Ze[e]}async incrementDownloadNotificationTimestamp(){const e=Date.now()+Qe;await this.appStorage.setItems({downloadNotificationTimestamp:e})}async setBlockAds(e){await this.appStorage.setItems({blockAds:e})}async incrementRateUs(){const e={needShow:this.rateUsData.showCount<nt,nextTimestamp:Date.now()+tt,showCount:this.rateUsData.showCount+1};await this.appStorage.setItems({rateUs:e})}async setExitOfferShown(){await this.appStorage.setItems({exitOffer:{needShow:!1}})}async incrementConnectionSurvey(){const{connectionSurvey:e}=this.appStorage.state;await this.appStorage.setItems({connectionSurvey:{...e,nextTimestamp:Date.now()+st}})}async closeConnectionSurvey(){const{close:e}=this.appStorage.state.connectionSurvey,s=e.count+1,c=e.nextTimestamp<Date.now()&&s%2===0,u=c?Date.now()+it:e.nextTimestamp,p={needShow:c,count:s,nextTimestamp:u};await this.appStorage.setItems({connectionSurvey:{...this.appStorage.state.connectionSurvey,close:p}})}async delayConnectionSurvey(){const{connectionSurvey:e}=this.appStorage.state;await this.appStorage.setItems({connectionSurvey:{...e,nextTimestamp:Date.now()+rt}})}async disableConnectionSurvey(){const{connectionSurvey:e}=this.appStorage.state;await this.appStorage.setItems({connectionSurvey:{...e,active:!1}})}get banner2Session(){const{banner2Session:e}=this.appStorage.state;return e}async disableBanner2Session(){await this.appStorage.setItems({banner2Session:{active:!1}})}get banner3Connection(){const{banner3Connection:e}=this.appStorage.state;return e}async disableBanner3Connection(){await this.appStorage.setItems({banner3Connection:{active:!1}})}get banner15Connection(){const{banner15Connection:e}=this.appStorage.state;return e}async disableBanner15Connection(){await this.appStorage.setItems({banner15Connection:{active:!1}})}get banner14Days(){const{banner14Days:e}=this.appStorage.state;return e}async activateBanner14Days(){await this.appStorage.setItems({banner14Days:{...this.banner14Days,active:!0}})}async disableBanner14Days(){await this.appStorage.setItems({banner14Days:{nextTimestamp:Date.now()+ie,active:!1}})}get banner16Days(){const{banner16Days:e}=this.appStorage.state;return e}async disableBanner16Days(){await this.appStorage.setItems({banner16Days:{...this.banner16Days,active:!1}})}}const yt=new k("app",bt,x),gn=new wt(yt),St=["allowed","denied"],xt="allowed",_t="/icons/128.png",It=["download-app","extension-updated"],Ct=g({id:b().uuid(),callback:I(It).optional()}),kt=g({permition:I(St).optional().describe(h.persist),callbacks:D(Ct).optional().describe(h.session)}).default({}),Tt=new C(kt);class Pt extends _{constructor(e){super(),this.notificationStorage=e}get permition(){return this.notificationStorage.state.permition??xt}get callbacks(){return this.notificationStorage.state.callbacks??[]}async boot(){await this.notificationStorage.sync(),this.bootResolve(),await this.bootPromise}async setNotificationPermition(e){await this.notificationStorage.setItems({permition:e})}getCallbackSettings(e){return this.callbacks.find(c=>c.id===e)??null}async removeCallbackSettings(e){const c=((await this.notificationStorage.getItems("callbacks")).callbacks??[]).filter(u=>u.id!==e);await this.notificationStorage.setItems({callbacks:c})}async notify(e){if(this.notificationStorage.state.permition==="denied")return;const s=S.runtime.getManifest(),c=S.runtime.getURL(_t),u={type:"basic",title:s.name,message:s.description??"",iconUrl:c},p=await S.notifications.create(crypto.randomUUID(),{...u,...e.options}),d=[...this.callbacks,{id:p,...e.callback?{callback:e.callback}:{}}];await this.notificationStorage.setItems({callbacks:d})}}const Et=new k("notification",Tt,x),mn=new Pt(Et),V=["free","premium"],Rt=["available","unavailable"],Dt=g({accessToken:b(),refreshToken:b()}),H=g({type:I(V),url:b(),status:I(Rt),updatedAt:w()}),At=g({tokens:Dt.optional().describe(h.persist),[V[0]]:H.optional().describe(h.persist),[V[1]]:H.optional().describe(h.persist)}).default({}),Ot=new C(At),z={authRefreshToken:"/auth/refresh-token/",authLogin:"/auth/login/",authLogout:"/auth/logout/",apiLaunch:"/api/launch/",apiLocationList:"/api/location/list/",apiServerList:"/api/server/list/",apiAvailable:"/api/available/",apiAccountAuthToken:"/api/account/account-auth-token/",apiUrlReview:"/api/url/review/",apiSubscriptionCheckUsedTrial:"/api/v2/subscription/check-used-trial/",apiSubscriptionSlot:"/api/v2/subscription/slot/",apiSlotRelease:"/api/v2/slot/release/",apiSubscriptionShield:"/api/v2/subscription/shield/",apiRemoteConfig:"/api/config/popup/"},Lt="https://antpeak.com",Nt="https://zorvian.com",X="https://s3-oregon-1.s3-us-west-2.amazonaws.com/api.json",J="https://proigor.com/payload.json",zt=3600*1e3,$t=g({free:b(),premium:b(),domains:g({free:D(b()).nonempty(),premium:D(b()).nonempty()})}),Z=oe(navigator.userAgent);class $ extends _{constructor(e,s,c,u,p,d){super(),this.apiStorage=c,this.globalStateService=u,this.fetchService=p,this.analyticsService=d,this.domainType=e,this.domainUrl=s}domainType;domainUrl;get hasTokens(){return!!this.apiStorage.state.tokens}get deviceInfo(){const e="chrome",s=S.runtime.getManifest(),c=Z.browser.name??"Chrome",u=Z.browser.version??"0.0.0";return{udid:this.globalStateService.udid.value,appVersion:s.version,platform:e,platformVersion:navigator.userAgent,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,deviceName:`${c} ${u}`}}get isDomainAvailable(){const e=this.apiStorage.state[this.domainType];if(!e)return!1;const s=e.updatedAt+zt;return!!e.url&&e.status==="available"&&s>Date.now()}get apiDomainUrl(){return this.apiStorage.state[this.domainType]?.url||this.domainUrl}async boot(){await this.apiStorage.sync(),this.isDomainAvailable||await this.updateDomainData(),this.bootResolve(),await this.bootPromise}async setTokens(e){await this.apiStorage.setItems({tokens:e})}async removeTokens(){await this.apiStorage.removeItems("tokens")}async updateDomainData(){const e=this.apiStorage.state[this.domainType]?.url;if(e&&await this.apiGetDomainStatus(e)){await this.apiStorage.setItems({[this.domainType]:{type:this.domainType,url:e,status:"available",updatedAt:Date.now()}});return}if(await this.apiGetDomainStatus(this.domainUrl)){await this.apiStorage.setItems({[this.domainType]:{type:this.domainType,url:this.domainUrl,status:"available",updatedAt:Date.now()}});return}const c=await this.apiGetReserveDomains();if(c.success){const u=$.shuffleArray(c.data.domains[this.domainType]);for(const p of u)if(await this.apiGetDomainStatus(p,!0)){await this.apiStorage.setItems({[this.domainType]:{type:this.domainType,url:p,status:"available",updatedAt:Date.now()}});return}}await this.apiStorage.setItems({[this.domainType]:{type:this.domainType,url:"",status:"unavailable",updatedAt:0}})}async fetch(e){if(!this.isDomainAvailable)return{success:!1,errors:[{code:0,status:0,name:"",message:"Connection Error. Api domain is unavailable. Try to reset app."}]};const s=this.apiStorage.state[this.domainType]?.url+z[e.url];return await this.request({...e,url:s})}async apiGetReserveDomains(){const c=le(Intl.DateTimeFormat().resolvedOptions().timeZone)?.countries.some(u=>u.toLocaleLowerCase()==="ru")?[J,X]:[X,J];for(const u of c){let p=await this.fetchService.request({method:"GET",url:u});if(p.success){if($t.safeParse(p.data).success)return p;p={success:!1,errors:[{code:0,status:0,name:"",message:"Invalid response from bucket"}]}}this.analyticsService.sendEvent({types:["google-analytics"],name:"api_no_response_bucket",data:{api_domain:u,status_code:L.getStatusCodeMessage(p)}})}return{success:!1,errors:[{code:0,status:0,name:"",message:"Connection Error. Api domain is unavailable. Try to reset app."}]}}async apiGetDomainStatus(e,s=!1){const c=await this.fetchService.request({method:"GET",url:`${e}${z.apiAvailable}`});return c.success||this.analyticsService.sendEvent({types:["google-analytics"],name:s?"api_no_response_reserve":"api_no_response_default",data:{api_domain:e,status_code:L.getStatusCodeMessage(c)}}),c.success?c.data.message==="OK":!1}static shuffleArray(e){const s=[...e];for(let c=s.length-1;c>=0;c--){const u=Math.floor(Math.random()*(c+1));[s[c],s[u]]=[s[u],s[c]]}return s}}class Ut extends ${constructor(e,s,c,u,p,d,m){super(e,s,c,u,p,m),this.apiStorage=c,this.globalStateService=u,this.fetchService=p,this.eventService=d,this.analyticsService=m}async request(e){const s=this.apiStorage.state.tokens?.accessToken??"",c=await this.fetchService.request({...e,headers:{Authorization:`Bearer ${s}`,...e.headers}});if(c.success||c.errors.every(m=>m.status!==401))return c;const p=this.apiStorage.state.tokens?.accessToken??"",d=await this.fetchService.request({headers:{Authorization:`Bearer ${p}`},method:"POST",url:this.apiDomainUrl+z.apiLaunch,body:this.deviceInfo});return d.success?(await this.setTokens({accessToken:d.data.accessToken,refreshToken:""}),this.request(e)):(this.eventService.dispatch({"free-refresh-token-failed":{disconnectReason:p?this.apiDomainUrl:"token_empty",failedReason:L.getStatusCodeMessage(d)}}),c)}}class jt extends ${constructor(e,s,c,u,p,d,m){super(e,s,c,u,p,m),this.apiStorage=c,this.globalStateService=u,this.fetchService=p,this.eventService=d,this.analyticsService=m}async request(e){const s=this.apiStorage.state.tokens?.accessToken??"",c=await this.fetchService.request({...e,headers:{Authorization:`Bearer ${s}`,...e.headers}});if(c.success||c.errors.every(m=>m.status!==401))return c;const p=this.apiStorage.state.tokens?.refreshToken??"",d=await this.fetchService.request({headers:{Authorization:`Bearer ${p}`},method:"POST",url:this.apiDomainUrl+z.authRefreshToken,body:this.deviceInfo});return d.success?(await this.setTokens({accessToken:d.data.accessToken,refreshToken:d.data.refreshToken}),this.request(e)):(this.eventService.dispatch({"premium-refresh-token-failed":{disconnectReason:p?this.apiDomainUrl:"token_empty",failedReason:L.getStatusCodeMessage(d)}}),c)}}const ae=new k("api",Ot,x),bn=new Ut("free",Lt,ae,B,te,x,ne),vn=new jt("premium",Nt,ae,B,te,x,ne),Mt=g({blockWebrtc:y().optional().describe(h.persist)}).default({}),Vt=new C(Mt),M="disable_non_proxied_udp";class R extends _{constructor(e){super(),this.webrtcStorage=e,this.setting.onChange.addListener(s=>{this.details=s,R.settingChangeResolver()})}setting=S.privacy.network.webRTCIPHandlingPolicy;details={levelOfControl:"not_controllable",value:"default"};static settingChangeResolver=()=>{};get canControlWebrtc(){const{levelOfControl:e,value:s}=this.details;return e==="not_controllable"||e==="controlled_by_other_extensions"?{status:!1,cause:e}:e==="controllable_by_this_extension"&&s===M?{status:!1,cause:"controlled_by_other_extensions"}:{status:!0}}get isApplied(){const{levelOfControl:e,value:s}=this.details;return e==="controlled_by_this_extension"&&s===M}get needEnableWebrtc(){return!!this.webrtcStorage.state.blockWebrtc}async boot(){await this.webrtcStorage.sync(),this.details=await this.setting.get({}),this.bootResolve(),await this.bootPromise}async enable(){if(!this.canControlWebrtc.status)return this.canControlWebrtc;const e=new Promise(s=>{R.settingChangeResolver=s});return await this.setting.set({value:M,scope:"regular"}),await e,this.canControlWebrtc}async disable(){if(!this.canControlWebrtc.status)return this.canControlWebrtc;const e=new Promise(s=>{R.settingChangeResolver=s});return await this.setting.clear({}),await e,this.canControlWebrtc}async setBlockWebrtc(e){await this.webrtcStorage.setItems({blockWebrtc:e})}}const Bt=new k("webrtc-settings",Vt,x),wn=new R(Bt),Wt=["udp","tcp","ipsec","https","http","sws","wg"],Ft=g({addresses:D(b()),protocol:I(Wt),port:w()}),qt=g({username:b(),password:b()}),Gt=g({credentials:qt.optional().describe(h.persist),serverConfigList:D(Ft).optional().describe(h.persist)}).default({}),Kt=new C(Gt);class E extends _{constructor(e){super(),this.proxyStorage=e,this.setting.onChange.addListener(s=>{this.details=s,E.settingChangeResolver()})}setting=S.proxy.settings;details={levelOfControl:"not_controllable",value:{mode:"system"}};static settingChangeResolver=()=>{};get canControlProxy(){const{levelOfControl:e}=this.details;return e==="not_controllable"||e==="controlled_by_other_extensions"?{status:!1,cause:e}:{status:!0}}get isApplied(){const{levelOfControl:e}=this.details;return e==="controlled_by_this_extension"}async getAuthCredentials(){const{credentials:e}=await this.proxyStorage.getItems("credentials");return e??null}async getServerConfigList(){const{serverConfigList:e}=await this.proxyStorage.getItems("serverConfigList");return e??[]}async boot(){await this.proxyStorage.sync();const e=await this.setting.get({});this.details=e,this.bootResolve(),await this.bootPromise}async enable(e){if(this.isApplied)return this.canControlProxy;if(!this.canControlProxy.status)return this.canControlProxy;await this.proxyStorage.setItems({credentials:e.credentials,serverConfigList:e.serverConfig});const s=new Promise(u=>{E.settingChangeResolver=u}),c=E.createProxyConfig(e);return await this.setting.set({value:c,scope:"regular"}),await s,this.canControlProxy}async disable(){if(!this.isApplied)return!0;await this.proxyStorage.removeItems("credentials","serverConfigList");const e=new Promise(s=>{E.settingChangeResolver=s});return await this.setting.clear({}),await e,!this.isApplied}static createProxyConfig(e){const s=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,c=e.serverConfig.flatMap(p=>{const d=p.protocol.toUpperCase();return p.addresses.map(m=>`${d} ${m}:${p.port}`)}).join("; ");return{mode:"pac_script",pacScript:{data:`
      function FindProxyForURL(url, host) {
        const areHostnamesEqual = (hostnameA, hostnameB) => {
          const wwwRegex = /^www\\./;
          const oldHostnameWithoutWww = hostnameA.replace(wwwRegex, '');
          const newHostnameWithoutWww = hostnameB.replace(wwwRegex, '');
          return oldHostnameWithoutWww === newHostnameWithoutWww;
        };

        if (isPlainHostName(host)) {
          return 'DIRECT';
        }

        const ipv4Regex = new RegExp(${s});
        const nonRoutableNets = ${JSON.stringify(e.nonRoutableNets)};
        if (ipv4Regex.test(host) && nonRoutableNets.some(([pattern, mask]) => isInNet(host, pattern, mask))) {
          return 'DIRECT';
        }

        const exclusions = ${JSON.stringify(e.exclusionList)};
        if (exclusions.some(el => (areHostnamesEqual(host, el) || shExpMatch(host, el)))) {
          return 'DIRECT';
        }

        return '${c}';
      }`}}}async getControlProxyStatus(){return Promise.resolve(this.canControlProxy)}}const Yt=new k("proxy",Kt,x),yn=new E(Yt),Ht=g({matchPattern:b(),favicon:b().optional()}),Xt=g({exclusions:Ht.array().optional().describe(h.persist)}).default({}),Jt=new C(Xt);var O={exports:{}},Zt=O.exports,Q;function Qt(){return Q||(Q=1,(function(v){(function(e){const s="(0?\\d+|0x[a-f0-9]+)",c={fourOctet:new RegExp(`^${s}\\.${s}\\.${s}\\.${s}$`,"i"),threeOctet:new RegExp(`^${s}\\.${s}\\.${s}$`,"i"),twoOctet:new RegExp(`^${s}\\.${s}$`,"i"),longValue:new RegExp(`^${s}$`,"i")},u=new RegExp("^0[0-7]+$","i"),p=new RegExp("^0x[a-f0-9]+$","i"),d="%[0-9a-z]{1,}",m="(?:[0-9a-f]+::?)+",P={zoneIndex:new RegExp(d,"i"),native:new RegExp(`^(::)?(${m})?([0-9a-f]+)?(::)?(${d})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${s}\\.${s}\\.${s}\\.${s}(${d})?)$`,"i"),transitional:new RegExp(`^((?:${m})|(?:::)(?:${m})?)${s}\\.${s}\\.${s}\\.${s}(${d})?$`,"i")};function W(t,n){if(t.indexOf("::")!==t.lastIndexOf("::"))return null;let r=0,o=-1,a=(t.match(P.zoneIndex)||[])[0],i,f;for(a&&(a=a.substring(1),t=t.replace(/%.+$/,""));(o=t.indexOf(":",o+1))>=0;)r++;if(t.substr(0,2)==="::"&&r--,t.substr(-2,2)==="::"&&r--,r>n)return null;for(f=n-r,i=":";f--;)i+="0:";return t=t.replace("::",i),t[0]===":"&&(t=t.slice(1)),t[t.length-1]===":"&&(t=t.slice(0,-1)),n=(function(){const q=t.split(":"),G=[];for(let U=0;U<q.length;U++)G.push(parseInt(q[U],16));return G})(),{parts:n,zoneId:a}}function F(t,n,r,o){if(t.length!==n.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let a=0,i;for(;o>0;){if(i=r-o,i<0&&(i=0),t[a]>>i!==n[a]>>i)return!1;o-=r,a+=1}return!0}function T(t){if(p.test(t))return parseInt(t,16);if(t[0]==="0"&&!isNaN(parseInt(t[1],10))){if(u.test(t))return parseInt(t,8);throw new Error(`ipaddr: cannot parse ${t} as octal`)}return parseInt(t,10)}function ce(t,n){for(;t.length<n;)t=`0${t}`;return t}const l={};l.IPv4=(function(){function t(n){if(n.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let r,o;for(r=0;r<n.length;r++)if(o=n[r],!(0<=o&&o<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=n}return t.prototype.SpecialRanges={unspecified:[[new t([0,0,0,0]),8]],broadcast:[[new t([255,255,255,255]),32]],multicast:[[new t([224,0,0,0]),4]],linkLocal:[[new t([169,254,0,0]),16]],loopback:[[new t([127,0,0,0]),8]],carrierGradeNat:[[new t([100,64,0,0]),10]],private:[[new t([10,0,0,0]),8],[new t([172,16,0,0]),12],[new t([192,168,0,0]),16]],reserved:[[new t([192,0,0,0]),24],[new t([192,0,2,0]),24],[new t([192,88,99,0]),24],[new t([198,18,0,0]),15],[new t([198,51,100,0]),24],[new t([203,0,113,0]),24],[new t([240,0,0,0]),4]],as112:[[new t([192,175,48,0]),24],[new t([192,31,196,0]),24]],amt:[[new t([192,52,193,0]),24]]},t.prototype.kind=function(){return"ipv4"},t.prototype.match=function(n,r){let o;if(r===void 0&&(o=n,n=o[0],r=o[1]),n.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return F(this.octets,n.octets,8,r)},t.prototype.prefixLengthFromSubnetMask=function(){let n=0,r=!1;const o={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let a,i,f;for(a=3;a>=0;a-=1)if(i=this.octets[a],i in o){if(f=o[i],r&&f!==0)return null;f!==8&&(r=!0),n+=f}else return null;return 32-n},t.prototype.range=function(){return l.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){return this.octets.slice(0)},t.prototype.toIPv4MappedAddress=function(){return l.IPv6.parse(`::ffff:${this.toString()}`)},t.prototype.toNormalizedString=function(){return this.toString()},t.prototype.toString=function(){return this.octets.join(".")},t})(),l.IPv4.broadcastAddressFromCIDR=function(t){try{const n=this.parseCIDR(t),r=n[0].toByteArray(),o=this.subnetMaskFromPrefixLength(n[1]).toByteArray(),a=[];let i=0;for(;i<4;)a.push(parseInt(r[i],10)|parseInt(o[i],10)^255),i++;return new this(a)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},l.IPv4.isIPv4=function(t){return this.parser(t)!==null},l.IPv4.isValid=function(t){try{return new this(this.parser(t)),!0}catch{return!1}},l.IPv4.isValidCIDR=function(t){try{return this.parseCIDR(t),!0}catch{return!1}},l.IPv4.isValidFourPartDecimal=function(t){return!!(l.IPv4.isValid(t)&&t.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},l.IPv4.networkAddressFromCIDR=function(t){let n,r,o,a,i;try{for(n=this.parseCIDR(t),o=n[0].toByteArray(),i=this.subnetMaskFromPrefixLength(n[1]).toByteArray(),a=[],r=0;r<4;)a.push(parseInt(o[r],10)&parseInt(i[r],10)),r++;return new this(a)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},l.IPv4.parse=function(t){const n=this.parser(t);if(n===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(n)},l.IPv4.parseCIDR=function(t){let n;if(n=t.match(/^(.+)\/(\d+)$/)){const r=parseInt(n[2]);if(r>=0&&r<=32){const o=[this.parse(n[1]),r];return Object.defineProperty(o,"toString",{value:function(){return this.join("/")}}),o}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},l.IPv4.parser=function(t){let n,r,o;if(n=t.match(c.fourOctet))return(function(){const a=n.slice(1,6),i=[];for(let f=0;f<a.length;f++)r=a[f],i.push(T(r));return i})();if(n=t.match(c.longValue)){if(o=T(n[1]),o>4294967295||o<0)throw new Error("ipaddr: address outside defined range");return(function(){const a=[];let i;for(i=0;i<=24;i+=8)a.push(o>>i&255);return a})().reverse()}else return(n=t.match(c.twoOctet))?(function(){const a=n.slice(1,4),i=[];if(o=T(a[1]),o>16777215||o<0)throw new Error("ipaddr: address outside defined range");return i.push(T(a[0])),i.push(o>>16&255),i.push(o>>8&255),i.push(o&255),i})():(n=t.match(c.threeOctet))?(function(){const a=n.slice(1,5),i=[];if(o=T(a[2]),o>65535||o<0)throw new Error("ipaddr: address outside defined range");return i.push(T(a[0])),i.push(T(a[1])),i.push(o>>8&255),i.push(o&255),i})():null},l.IPv4.subnetMaskFromPrefixLength=function(t){if(t=parseInt(t),t<0||t>32)throw new Error("ipaddr: invalid IPv4 prefix length");const n=[0,0,0,0];let r=0;const o=Math.floor(t/8);for(;r<o;)n[r]=255,r++;return o<4&&(n[o]=Math.pow(2,t%8)-1<<8-t%8),new this(n)},l.IPv6=(function(){function t(n,r){let o,a;if(n.length===16)for(this.parts=[],o=0;o<=14;o+=2)this.parts.push(n[o]<<8|n[o+1]);else if(n.length===8)this.parts=n;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(o=0;o<this.parts.length;o++)if(a=this.parts[o],!(0<=a&&a<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");r&&(this.zoneId=r)}return t.prototype.SpecialRanges={unspecified:[new t([0,0,0,0,0,0,0,0]),128],linkLocal:[new t([65152,0,0,0,0,0,0,0]),10],multicast:[new t([65280,0,0,0,0,0,0,0]),8],loopback:[new t([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new t([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new t([0,0,0,0,0,65535,0,0]),96],discard:[new t([256,0,0,0,0,0,0,0]),64],rfc6145:[new t([0,0,0,0,65535,0,0,0]),96],rfc6052:[new t([100,65435,0,0,0,0,0,0]),96],"6to4":[new t([8194,0,0,0,0,0,0,0]),16],teredo:[new t([8193,0,0,0,0,0,0,0]),32],benchmarking:[new t([8193,2,0,0,0,0,0,0]),48],amt:[new t([8193,3,0,0,0,0,0,0]),32],as112v6:[[new t([8193,4,274,0,0,0,0,0]),48],[new t([9760,79,32768,0,0,0,0,0]),48]],deprecated:[new t([8193,16,0,0,0,0,0,0]),28],orchid2:[new t([8193,32,0,0,0,0,0,0]),28],droneRemoteIdProtocolEntityTags:[new t([8193,48,0,0,0,0,0,0]),28],reserved:[[new t([8193,0,0,0,0,0,0,0]),23],[new t([8193,3512,0,0,0,0,0,0]),32]]},t.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},t.prototype.kind=function(){return"ipv6"},t.prototype.match=function(n,r){let o;if(r===void 0&&(o=n,n=o[0],r=o[1]),n.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return F(this.parts,n.parts,16,r)},t.prototype.prefixLengthFromSubnetMask=function(){let n=0,r=!1;const o={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let a,i;for(let f=7;f>=0;f-=1)if(a=this.parts[f],a in o){if(i=o[a],r&&i!==0)return null;i!==16&&(r=!0),n+=i}else return null;return 128-n},t.prototype.range=function(){return l.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){let n;const r=[],o=this.parts;for(let a=0;a<o.length;a++)n=o[a],r.push(n>>8),r.push(n&255);return r},t.prototype.toFixedLengthString=function(){const n=(function(){const o=[];for(let a=0;a<this.parts.length;a++)o.push(ce(this.parts[a].toString(16),4));return o}).call(this).join(":");let r="";return this.zoneId&&(r=`%${this.zoneId}`),n+r},t.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const n=this.parts.slice(-2),r=n[0],o=n[1];return new l.IPv4([r>>8,r&255,o>>8,o&255])},t.prototype.toNormalizedString=function(){const n=(function(){const o=[];for(let a=0;a<this.parts.length;a++)o.push(this.parts[a].toString(16));return o}).call(this).join(":");let r="";return this.zoneId&&(r=`%${this.zoneId}`),n+r},t.prototype.toRFC5952String=function(){const n=/((^|:)(0(:|$)){2,})/g,r=this.toNormalizedString();let o=0,a=-1,i;for(;i=n.exec(r);)i[0].length>a&&(o=i.index,a=i[0].length);return a<0?r:`${r.substring(0,o)}::${r.substring(o+a)}`},t.prototype.toString=function(){return this.toRFC5952String()},t})(),l.IPv6.broadcastAddressFromCIDR=function(t){try{const n=this.parseCIDR(t),r=n[0].toByteArray(),o=this.subnetMaskFromPrefixLength(n[1]).toByteArray(),a=[];let i=0;for(;i<16;)a.push(parseInt(r[i],10)|parseInt(o[i],10)^255),i++;return new this(a)}catch(n){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${n})`)}},l.IPv6.isIPv6=function(t){return this.parser(t)!==null},l.IPv6.isValid=function(t){if(typeof t=="string"&&t.indexOf(":")===-1)return!1;try{const n=this.parser(t);return new this(n.parts,n.zoneId),!0}catch{return!1}},l.IPv6.isValidCIDR=function(t){if(typeof t=="string"&&t.indexOf(":")===-1)return!1;try{return this.parseCIDR(t),!0}catch{return!1}},l.IPv6.networkAddressFromCIDR=function(t){let n,r,o,a,i;try{for(n=this.parseCIDR(t),o=n[0].toByteArray(),i=this.subnetMaskFromPrefixLength(n[1]).toByteArray(),a=[],r=0;r<16;)a.push(parseInt(o[r],10)&parseInt(i[r],10)),r++;return new this(a)}catch(f){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${f})`)}},l.IPv6.parse=function(t){const n=this.parser(t);if(n.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(n.parts,n.zoneId)},l.IPv6.parseCIDR=function(t){let n,r,o;if((r=t.match(/^(.+)\/(\d+)$/))&&(n=parseInt(r[2]),n>=0&&n<=128))return o=[this.parse(r[1]),n],Object.defineProperty(o,"toString",{value:function(){return this.join("/")}}),o;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},l.IPv6.parser=function(t){let n,r,o,a,i,f;if(o=t.match(P.deprecatedTransitional))return this.parser(`::ffff:${o[1]}`);if(P.native.test(t))return W(t,8);if((o=t.match(P.transitional))&&(f=o[6]||"",n=o[1],o[1].endsWith("::")||(n=n.slice(0,-1)),n=W(n+f,6),n.parts)){for(i=[parseInt(o[2]),parseInt(o[3]),parseInt(o[4]),parseInt(o[5])],r=0;r<i.length;r++)if(a=i[r],!(0<=a&&a<=255))return null;return n.parts.push(i[0]<<8|i[1]),n.parts.push(i[2]<<8|i[3]),{parts:n.parts,zoneId:n.zoneId}}return null},l.IPv6.subnetMaskFromPrefixLength=function(t){if(t=parseInt(t),t<0||t>128)throw new Error("ipaddr: invalid IPv6 prefix length");const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const o=Math.floor(t/8);for(;r<o;)n[r]=255,r++;return o<16&&(n[o]=Math.pow(2,t%8)-1<<8-t%8),new this(n)},l.fromByteArray=function(t){const n=t.length;if(n===4)return new l.IPv4(t);if(n===16)return new l.IPv6(t);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},l.isValid=function(t){return l.IPv6.isValid(t)||l.IPv4.isValid(t)},l.isValidCIDR=function(t){return l.IPv6.isValidCIDR(t)||l.IPv4.isValidCIDR(t)},l.parse=function(t){if(l.IPv6.isValid(t))return l.IPv6.parse(t);if(l.IPv4.isValid(t))return l.IPv4.parse(t);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},l.parseCIDR=function(t){try{return l.IPv6.parseCIDR(t)}catch{try{return l.IPv4.parseCIDR(t)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},l.process=function(t){const n=this.parse(t);return n.kind()==="ipv6"&&n.isIPv4MappedAddress()?n.toIPv4Address():n},l.subnetMatch=function(t,n,r){let o,a,i,f;r==null&&(r="unicast");for(a in n)if(Object.prototype.hasOwnProperty.call(n,a)){for(i=n[a],i[0]&&!(i[0]instanceof Array)&&(i=[i]),o=0;o<i.length;o++)if(f=i[o],t.kind()===f[0].kind()&&t.match.apply(t,f))return a}return r},v.exports?v.exports=l:e.ipaddr=l})(Zt)})(O)),O.exports}var en=Qt();const ee=ue(en);class tn extends _{constructor(e){super(),this.exclusionsStorage=e}NON_ROUTABLE_IP_ADDRESS=["0.0.0.0/8","10.0.0.0/8","14.0.0.0/8","24.0.0.0/8","39.0.0.0/8","127.0.0.0/8","128.0.0.0/16","169.254.0.0/16","172.16.0.0/12","191.255.0.0/16","192.0.0.0/24","192.0.2.0/24","192.88.99.0/24","192.168.0.0/16","198.18.0.0/15","223.255.255.0/24","224.0.0.0/4","240.0.0.0/4"];DEFAULT_EXCLUSIONS=["::1","localhost","*.local","127.0.0.1","analytics.google.com","*.analytics.google.com","google-analytics.com","*.google-analytics.com"];get nonRoutableNets(){const e=s=>{const[c,u]=ee.parseCIDR(s);return[c.toString(),ee.IPv4.subnetMaskFromPrefixLength(u).toString()]};return this.NON_ROUTABLE_IP_ADDRESS.map(e)}get exclusionList(){const e=this.exclusionSites.map(s=>s.matchPattern);return[...this.DEFAULT_EXCLUSIONS,...e]}get nonRoutableList(){return[...this.NON_ROUTABLE_IP_ADDRESS]}get exclusionSites(){return this.exclusionsStorage.state.exclusions??[]}async boot(){await this.exclusionsStorage.sync(),this.bootResolve(),await this.bootPromise}async add(e){await this.exclusionsStorage.setItems({exclusions:[...this.exclusionSites,e]})}async remove(e){const s=this.exclusionSites.filter(c=>c.matchPattern!==e.matchPattern);await this.exclusionsStorage.setItems({exclusions:s})}}const nn=new k("exclusions",Jt,x),Sn=new tn(nn),on=["disconnected","connecting","connected","disconnecting"],sn="disconnected",rn=g({status:I(on).optional().describe(h.persist),ipAddress:b().optional().describe(h.session),connectionCount:w().describe(h.persist),useAutoConnect:y().optional().describe(h.persist),connectedAt:w().optional().describe(h.persist)}).default({connectionCount:0}),an=new C(rn);class cn extends _{constructor(e){super(),this.connectionStorage=e}get currentIp(){return this.connectionStorage.state.ipAddress}get status(){return this.connectionStorage.state.status??sn}get isConnected(){return this.connectionStorage.state.status==="connected"}get connectionCount(){return this.connectionStorage.state.connectionCount}get useAutoConnect(){return!!this.connectionStorage.state.useAutoConnect}get connectedAt(){return this.connectionStorage.state.connectedAt||0}async boot(){await this.connectionStorage.sync(),this.bootResolve(),await this.bootPromise}async setIpAddress(e){await this.connectionStorage.setItems({ipAddress:e})}async removeIpAddress(){await this.connectionStorage.removeItems("ipAddress")}async setConnectionStatus(e){await this.connectionStorage.setItems({status:e})}async incrementConnectionCount(){const e=this.connectionStorage.state.connectionCount+1;await this.connectionStorage.setItems({connectionCount:e})}async setAutoConnect(e){await this.connectionStorage.setItems({useAutoConnect:e})}async setConnectedAt(){const e=Date.now();await this.connectionStorage.setItems({connectedAt:e})}async resetConnectedAt(){await this.connectionStorage.setItems({connectedAt:0})}}const ln=new k("connection",an,x),xn=new cn(ln);export{A as D,fn as a,gn as b,bn as c,vn as d,Sn as e,xn as f,re as g,xt as h,Be as i,mn as n,yn as p,wn as w};
