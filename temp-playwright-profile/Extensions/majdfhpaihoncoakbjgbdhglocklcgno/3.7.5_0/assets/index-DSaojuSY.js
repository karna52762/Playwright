import{o as n,_ as f,n as S,i as v,S as h,c as b,E as u,t as g,d,e as l,g as m,u as y,b as p}from"./index-BJq-9179.js";import{S as O,m as E}from"./index-BwDjUviV.js";const i=4320*60*1e3,T=300*1e3;var r=(t=>(t.discount="discount",t.trial="trial",t))(r||{});const w=n({active:v(),startedAt:S(),type:f(r)}),A=n({banner:w.optional().describe(h.session)}).default({}),I=new b(A);class P extends O{constructor(e,a,s,o,c){super(),this.introOfferStorage=e,this.globalStateService=a,this.messageService=s,this.userService=o,this.abTestsService=c}get introOfferType(){const e=this.abTestsService.getExperimentStatus(u.onboardingExitOffer);return e.active&&e.group===g.test?r.trial:r.discount}get active(){const e=this.userService.userType==="free",a=this.globalStateService.installedAt+i,s=Date.now()<a;return e&&s}get data(){return{active:this.active,endedAt:this.globalStateService.installedAt+i,type:this.introOfferType}}get banner(){const{banner:e}=this.introOfferStorage.state;return e?{...e,active:e.active&&this.active}:{active:!1,startedAt:Date.now(),type:this.introOfferType}}async boot(){await this.introOfferStorage.sync(),this.bootResolve(),await this.bootPromise}async activateBanner(){await this.introOfferStorage.setItems({banner:{startedAt:Date.now()+T,active:!0,type:this.introOfferType}}),this.messageService.notifyTab({type:"intro-offer-banner-state-change",success:!0,data:this.banner})}async deactivateBanner(){await this.introOfferStorage.removeItems("banner"),this.messageService.notifyTab({type:"intro-offer-banner-state-change",success:!0,data:this.banner})}}const D=new d("intro-offer",I,l),R=new P(D,m,E,y,p);export{r as I,R as i};
